import{N as d}from"./index-CeSPOaTc.js";import{D as u,d as A,u as p,p as P}from"./DragUpload-DXlmm2Yc.js";import{e as N,f as Y}from"./primevue-CbY-VKnM.js";import{x as v,b as i,o as O,f,s as t,h as s,L as c,F as k}from"./@vue-B4Rme-ED.js";import"./vue-router-B47mcnGi.js";/* empty css                   */import"./@master-hp_0R5gD.js";import"./axios-Cm0UX6qg.js";const h={class:"mt:20 flex:row font:normal font:sans f:25"},_={class:"flex flex:row"},g={class:"flex:col w:50% mr:1%"},L=s("label",{class:"w:25% mr:5",for:"selcode"},"1.選擇系統",-1),w=s("label",{class:"flex mt:15"},"2.載入AP程式(.DLL 並開始更新)",-1),x={class:"flex:col w:50%"},T=s("label",{class:"flex mt:15"},"3.執行結果",-1),y=s("br",null,null,-1),B={__name:"ap",setup(D){const S=v("toast"),a=i({response:"",temp:"",isLoading:!1}),n=i({name:"* 請選擇系統",APSYSNO:"*",ncik:"請選擇系統"}),r=i([{name:"* 請選擇系統",APSYSNO:"*",ncik:"請選擇系統"},{name:"TM 高階主管",APSYSNO:"TM",ncik:"高階主管"},{name:"AC 會計系統",APSYSNO:"AC",ncik:"會計系統"},{name:"CA 出納系統",APSYSNO:"CA",ncik:"出納系統"},{name:"TX 媒體申報",APSYSNO:"TX",ncik:"媒體申報"},{name:"PU 估驗系統",APSYSNO:"PU",ncik:"估驗系統"},{name:"ES 估算系統",APSYSNO:"ES",ncik:"估算系統"},{name:"PS 人事系統",APSYSNO:"PS",ncik:"人事系統"},{name:"MS 物料倉管",APSYSNO:"MS",ncik:"物料倉管"},{name:"PT 工程進度",APSYSNO:"PT",ncik:"工程進度"},{name:"PL 年度預算",APSYSNO:"PL",ncik:"年度預算"},{name:"DV 土地開發",APSYSNO:"DV",ncik:"土地開發"},{name:"WS 水電估算",APSYSNO:"WS",ncik:"水電估算"},{name:"ST 鋼筋撿料",APSYSNO:"ST",ncik:"鋼筋撿料"},{name:"SA 銷售系統",APSYSNO:"SA",ncik:"銷售系統"},{name:"EC 變更追加減",APSYSNO:"EC",ncik:"變更追加減"},{name:"QC 品質查核",APSYSNO:"QC",ncik:"品質查核"},{name:"PA 銷售前置",APSYSNO:"PA",ncik:"銷售前置"},{name:"ADMISYS 績效考核",APSYSNO:"ADMISYS",ncik:"績效考核"},{name:"MAINTSYS 客戶服務",APSYSNO:"MAINTSYS",ncik:"客戶服務"},{name:"HEALTSYS 健康管理",APSYSNO:"HEALTSYS",ncik:"健康管理"}]),m=async o=>{if(n.value.APSYSNO=="*"){S.add({severity:"error",summary:"系統別錯誤",detail:"請先選擇系統",life:1e4});return}a.value.isLoading=!0;let l=new FormData;l.append("file",o[0]);try{await A("/dll/"+n.value.APSYSNO).then(e=>{a.value.response=n.value.APSYSNO+` 系統關閉! 
移除了 `+e.data.count+` 個元件.
`,a.value.temp=e.data.msg+`
`,console.log("log:",e)}).catch(e=>{throw console.error("error:",e),e}),await p("put","/dll/",l).then(e=>{a.value.response+=o[0].name+` 上傳成功!
`,a.value.temp+=e.data.msg+`
`}).catch(e=>{throw console.error("error:",e),e}),await P("/dll/"+n.value.APSYSNO,{dllpath:o[0].name}).then(e=>{a.value.response+="AP "+e.data.path+" 成功安裝到 "+n.value.APSYSNO+`.
`,a.value.temp+=e.data.msg+`
`}).catch(e=>{throw console.error("error:",e),e}),a.value.response=a.value.response+`

`+a.value.temp,a.value.isLoading=!1,S.add({severity:"success",summary:"AP更新成功",detail:o[0].name+" 已上傳並安裝到 "+n.value.APSYSNO,life:15e3})}catch(e){a.value.response=e.response.data.msg,S.add({severity:"success",summary:o[0].name+"更新失敗",detail:e,life:15e3}),a.value.isLoading=!1}};return(o,l)=>(O(),f(k,null,[t(d,{text:"AP 更新"}),s("div",h,[s("div",_,[s("div",g,[L,t(c(N),{class:"",id:"selcode",modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=e=>n.value=e),options:r.value,optionLabel:"name",placeholder:"選擇系統",checkmark:"",highlightOnSelect:!1},null,8,["modelValue","options"]),w,t(u,{class:"flex mt:10",isLoading:a.value.isLoading,allowedExtension:"dll",onHandleFileDrop:m},null,8,["isLoading"])]),s("div",x,[T,t(c(Y),{class:"mt:15",modelValue:a.value.response,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value.response=e),rows:"12",cols:"60",readonly:""},null,8,["modelValue"])]),y])])],64))}};export{B as default};
