import{E as D}from"./exceljs-AYXMgrKX.js";import{N as U}from"./index-B2HebM-Z.js";import{D as L,p as V,d as P,g as p,u as M}from"./service-Blihfj6M.js";import{g as h,f as F,a as d,c as r,e as A,h as B,i as J,j as v}from"./primevue-Cpy0qCi2.js";import{y as H,r as E,b as z,c as Z,u as o,d as s,L as n,s as S,F as j,z as u}from"./@vue-El9F00iI.js";import"./@master-24VFnj-k.js";import"./vue-router-DwT636uc.js";import"./@primeuix-DoH5r5kp.js";import"./@primevue-CPyEe4-z.js";/* empty css                   */import"./axios-upsvKRUO.js";const $={class:"mt:20 flex font:normal font:sans f:20"},_={class:"flex:col mr:2% w:40%"},G={class:"flex flex:row mb:10"},W={class:"flex flex:row mb:5"},X={class:"flex flex:row mb:5"},K={class:"flex flex:row mb:5"},Q={class:"flex flex:row mb:5"},q={class:"flex flex:row mb:15"},ee={class:"flex flex:row mb:10"},le={class:"flex flex:row mb:10"},ae={class:"w:20% flex:col"},te={class:"flex flex:col"},se={class:"flex:col"},oe={class:"flex flex:row mb:10"},ne={class:"flex flex:row"},ie={class:"flex"},Pe={__name:"cl",setup(Se){const i=H("toast"),w=h(),f=E(),C=()=>{if(e.value.APSYSNO!=""){if(e.value.update==""){i.add({severity:"error",summary:"刪除錯誤",detail:"請先選擇紀錄",life:1e4});return}w.require({message:"確認刪除版本 "+e.value.version+" 的紀錄?",header:"Confirm",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined",acceptLabel:"OK",rejectLabel:"Cancel",accept:()=>{x()},reject:()=>{}})}},T=async()=>{const a=new D.Workbook,l=a.addWorksheet("系統更新紀錄",{properties:{defaultRowHeight:17},pageSetup:{fitToPage:!0,fitToWidth:1,fitToHeight:0},views:[{}]});l.columns=[{header:"",key:"COMPUTER",width:15,type:"string",style:{font:{size:10,name:"細明體"}}},{header:"",key:"UP_DATE",width:25,type:"string",style:{font:{size:10,name:"細明體"}}},{header:"",key:"Msg",width:25,type:"string",style:{font:{size:10,name:"細明體"}}},{header:"",key:"MEMO",width:33,type:"string",style:{font:{size:10,name:"細明體"}}}],l.addRow({COMPUTER:"系統更新紀錄"}),l.getRow(2).alignment={horizontal:"center"},l.mergeCells(2,1,2,4),l.addRow({COMPUTER:"系統編號："+e.value.selectedsystem.name}),l.mergeCells(3,1,3,4),l.addRow({COMPUTER:"版本",UP_DATE:"發布日期",Msg:"更新標題",MEMO:"更新詳述"}),l.getRow(4).alignment={horizontal:"center"},l.addRows(e.value.col.reverse(),3),l.getRow(2).font={size:12};const t=await a.xlsx.writeBuffer(),b=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),O=window.URL.createObjectURL(b),c=document.createElement("a");c.href=O,c.download="系統更新紀錄.xlsx",c.click(),window.URL.revokeObjectURL(O)},I=a=>{e.value.update=a.data.UP_DATE,e.value.version=a.data.COMPUTER},g=()=>{e.value.update="",e.value.version=""},e=E({version:"",update:"",SUBJECT:"",DESCRIPTION:"",isLoading:!1,isDragging:!1,selectedsystem:{name:"* 請選擇系統",APSYSNO:"*",ncik:"請選擇系統"},APSYSNO:"",VERSION:"",NDATE:"",FileName:"",FILESIZE:null,col:null}),y=E([{name:"* 請選擇系統",APSYSNO:"*",ncik:"請選擇系統"},{name:"TMGRSYS 高階主管",APSYSNO:"TMGRSYS",ncik:"高階主管"},{name:"ACNTSYS 會計系統",APSYSNO:"ACNTSYS",ncik:"會計系統"},{name:"CASHSYS 出納系統",APSYSNO:"CASHSYS",ncik:"出納系統"},{name:"TAXAPSYS 媒體申報",APSYSNO:"TAXAPSYS",ncik:"媒體申報"},{name:"EPURCSYS 估驗系統",APSYSNO:"EPURCSYS",ncik:"估驗系統"},{name:"EESTISYS 估算系統",APSYSNO:"EESTISYS",ncik:"估算系統"},{name:"PERSNSYS 人事系統",APSYSNO:"PERSNSYS",ncik:"人事系統"},{name:"MSIOSYS 物料倉管",APSYSNO:"MSIOSYS",ncik:"物料倉管"},{name:"PERTSYS 工程進度",APSYSNO:"PERTSYS",ncik:"工程進度"},{name:"PLANSYS 年度預算",APSYSNO:"PLANSYS",ncik:"年度預算"},{name:"DVEPSYS 土地開發",APSYSNO:"DVEPSYS",ncik:"土地開發"},{name:"WSESSYS 水電估算",APSYSNO:"WSESSYS",ncik:"水電估算"},{name:"STEELSYS 鋼筋撿料",APSYSNO:"STEELSYS",ncik:"鋼筋撿料"},{name:"SALESYS 銷售系統",APSYSNO:"SALESYS",ncik:"銷售系統"},{name:"ECHGSYS 變更追加減",APSYSNO:"ECHGSYS",ncik:"變更追加減"},{name:"CMISCCSYS 整合營建桌面",APSYSNO:"CMISCCSYS",ncik:"整合營建桌面"},{name:"CMISC_工地 整合工地桌面",APSYSNO:"CMISC_工地",ncik:"整合工地桌面"},{name:"QCTLSYS 品質查核",APSYSNO:"QCTLSYS",ncik:"品質查核"},{name:"PSALESYS 銷售前置",APSYSNO:"PSALESYS",ncik:"銷售前置"},{name:"ADMISYS 績效考核",APSYSNO:"ADMISYS",ncik:"績效考核"},{name:"MAINTSYS 客戶服務",APSYSNO:"MAINTSYS",ncik:"客戶服務"},{name:"HEALTSYS 健康管理",APSYSNO:"HEALTSYS",ncik:"健康管理"}]);e.value.isLoading=!1;const R=()=>{e.value.APSYSNO!=""&&V("/cl/cl/"+e.value.APSYSNO,{SUBJECT:e.value.SUBJECT,DESCRIPTION:e.value.DESCRIPTION}).then(a=>{m()}).catch(a=>{console.error("error:",a)})},k=()=>{e.value.APSYSNO!=""&&P("/cl/cl/"+e.value.APSYSNO).then(a=>{m()}).catch(a=>{console.error("error:",a)})},x=()=>{P("/cl/history/"+e.value.APSYSNO,{up_date:e.value.update,version:e.value.version}).then(a=>{e.value.col=a.data.data,N()}).catch(a=>{console.error("error:",a)})},m=()=>{if(e.value.selectedsystem.APSYSNO=="*"){i.add({severity:"error",summary:"系統別錯誤",detail:"請先選擇系統",life:1e4});return}p("/cl/pd/"+e.value.selectedsystem.APSYSNO).then(a=>{a.data.data.SUBJECT==""?(e.value.response=JSON.stringify(a.data,null,1),e.value.APSYSNO=e.value.selectedsystem.APSYSNO,e.value.VERSION="",e.value.NDATE=new Date(Date.now()).toLocaleString(),e.value.FileName="",e.value.FILESIZE="",e.value.SUBJECT=e.value.selectedsystem.ncik,e.value.DESCRIPTION=""):(e.value.response=JSON.stringify(a.data.data,null,1),e.value.APSYSNO=a.data.data.APSYSNO,e.value.VERSION=a.data.data.VERSION,e.value.NDATE=new Date(a.data.data.NDATE).toLocaleString(),e.value.FileName=a.data.data.FileName,e.value.FILESIZE=a.data.data.FILESIZE,e.value.SUBJECT=a.data.data.SUBJECT,e.value.DESCRIPTION=a.data.data.DESCRIPTION),N()}).catch(a=>{i.add({severity:"error",summary:"錯誤",detail:a,life:1e4}),console.error("error:",a)})},N=()=>{p("/cl/history/"+e.value.APSYSNO).then(a=>{e.value.col=a.data.data}).catch(a=>{console.error("error:",a)})},Y=a=>{if(e.value.selectedsystem.APSYSNO=="*"){i.add({severity:"error",summary:"系統別錯誤",detail:"請先選擇系統",life:1e4});return}if(e.value.APSYSNO==""){i.add({severity:"error",summary:"錯誤",detail:"請先查詢系統資料",life:1e4});return}e.value.Extension=".exe";let l=new FormData;l.append("file",a[0]),l.append("SUBJECT",e.value.SUBJECT),l.append("DESCRIPTION",e.value.DESCRIPTION),e.value.isLoading=!0,M("put","/cl/cl/"+e.value.selectedsystem.APSYSNO,l).then(t=>{e.value.isLoading=!1,i.add({severity:"success",summary:"上傳成功",detail:a[0].name+" 已上傳到 "+e.value.selectedsystem.APSYSNO+`
`+t.data.msg,life:15e3}),m()}).catch(t=>{e.value.isLoading=!1,i.add({severity:"error",summary:"上傳失敗",detail:t.response.data.msg,life:15e3}),console.error("error:",t)})};return(a,l)=>(z(),Z(j,null,[o(U,{text:"CL 更新"}),s("div",$,[s("div",_,[s("div",G,[l[12]||(l[12]=s("label",{class:"w:20%",for:"selcode"},"1.選擇系統",-1)),o(n(F),{class:"mr:10",id:"selcode",modelValue:e.value.selectedsystem,"onUpdate:modelValue":l[0]||(l[0]=t=>e.value.selectedsystem=t),options:y.value,optionLabel:"name",placeholder:"選擇系統",checkmark:"",highlightOnSelect:!0},null,8,["modelValue","options"]),o(n(d),{class:"mr:5",onClick:m},{default:S(()=>l[10]||(l[10]=[u("2.查詢")])),_:1}),o(n(d),{class:"ml:5",onClick:k},{default:S(()=>l[11]||(l[11]=[u("刪除")])),_:1})]),s("div",W,[l[13]||(l[13]=s("label",{class:"w:20%",for:"APSYSNO"},"系統編號",-1)),o(n(r),{modelValue:e.value.APSYSNO,"onUpdate:modelValue":l[1]||(l[1]=t=>e.value.APSYSNO=t),class:"w:80%",id:"APSYSNO",disabled:"",placeholder:""},null,8,["modelValue"])]),s("div",X,[l[14]||(l[14]=s("label",{class:"w:20%",for:"VERSION"},"版本",-1)),o(n(r),{modelValue:e.value.VERSION,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value.VERSION=t),class:"w:80%",id:"VERSION",disabled:"",placeholder:""},null,8,["modelValue"])]),s("div",K,[l[15]||(l[15]=s("label",{class:"w:20%",for:"NDATE"},"發布日期",-1)),o(n(r),{modelValue:e.value.NDATE,"onUpdate:modelValue":l[3]||(l[3]=t=>e.value.NDATE=t),class:"w:80%",id:"NDATE",disabled:"",placeholder:""},null,8,["modelValue"])]),s("div",Q,[l[16]||(l[16]=s("label",{class:"w:20%",for:"FileName"},"檔案名稱",-1)),o(n(r),{modelValue:e.value.FileName,"onUpdate:modelValue":l[4]||(l[4]=t=>e.value.FileName=t),class:"w:80%",id:"FileName",disabled:"",placeholder:""},null,8,["modelValue"])]),s("div",q,[l[17]||(l[17]=s("label",{class:"w:20%",for:"FILESIZE"},"檔案大小",-1)),o(n(r),{modelValue:e.value.FILESIZE,"onUpdate:modelValue":l[5]||(l[5]=t=>e.value.FILESIZE=t),class:"w:80%",id:"FILESIZE",disabled:"",placeholder:""},null,8,["modelValue"])]),s("div",ee,[l[18]||(l[18]=s("label",{class:"w:20%",for:"SUBJECT"},"3.更新標題",-1)),o(n(A),{modelValue:e.value.SUBJECT,"onUpdate:modelValue":l[6]||(l[6]=t=>e.value.SUBJECT=t),class:"w:80%",id:"SUBJECT",rows:"1",cols:"50"},null,8,["modelValue"])]),s("div",le,[s("div",ae,[l[20]||(l[20]=s("label",{class:"",for:"DESCRIPTION"},"4.更新詳述",-1)),o(n(d),{class:"mt:10 ml:10 mr:10 w:fit",onClick:R},{default:S(()=>l[19]||(l[19]=[u("儲存")])),_:1})]),o(n(A),{modelValue:e.value.DESCRIPTION,"onUpdate:modelValue":l[7]||(l[7]=t=>e.value.DESCRIPTION=t),class:"w:80%",id:"DESCRIPTION",rows:"5",cols:"50"},null,8,["modelValue"])]),s("div",te,[l[21]||(l[21]=s("label",null,"5.載入程式執行檔(.EXE 並開始上傳主機)",-1)),o(L,{allowedExtension:"exe",isLoading:e.value.isLoading,isDragging:e.value.isDragging,onHandleFileDrop:Y,onHandleFileOpen:Y},null,8,["isLoading","isDragging"])])]),s("div",se,[s("div",oe,[o(n(B)),o(n(d),{class:"ml:5",onClick:l[8]||(l[8]=t=>C()),label:"Save"},{default:S(()=>l[22]||(l[22]=[u("刪除紀錄")])),_:1}),o(n(d),{class:"ml:5",onClick:T},{default:S(()=>l[23]||(l[23]=[u("轉EXCEL")])),_:1})]),s("div",ne,[s("div",ie,[o(n(J),{value:e.value.col,selection:f.value,"onUpdate:selection":l[9]||(l[9]=t=>f.value=t),selectionMode:"single",metaKeySelection:!1,onRowSelect:I,onRowUnselect:g,tableStyle:"min-width:",scrollable:"",scrollHeight:"500px",resizableColumns:"",columnResizeMode:"fit",showGridlines:"",sortField:"UP_DATE",sortOrder:-1,ref:"dt"},{default:S(()=>[o(n(v),{field:"COMPUTER",header:"版本",style:{width:"min"}}),o(n(v),{field:"MEMO",header:"更新詳述",style:{width:"min"}}),o(n(v),{field:"UP_DATE",header:"發布時間",sortable:!0,style:{width:"min"}})]),_:1},8,["value","selection"])])])])])],64))}};export{Pe as default};
