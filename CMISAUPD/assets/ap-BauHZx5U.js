import{N as d}from"./index-B2HebM-Z.js";import{D as u,d as p,u as A,p as P}from"./service-Blihfj6M.js";import{f as N,e as Y}from"./primevue-Cpy0qCi2.js";import{y as v,r as i,b as O,c as f,u as t,d as l,L as m,F as k}from"./@vue-El9F00iI.js";import"./vue-router-DwT636uc.js";import"./@primeuix-DoH5r5kp.js";import"./@primevue-CPyEe4-z.js";/* empty css                   */import"./@master-24VFnj-k.js";import"./axios-upsvKRUO.js";const g={class:"mt:20 font:normal font:sans f:25"},L={class:"flex"},h={class:"flex:col w:50%"},w={class:"flex:col w:50%"},U={__name:"ap",setup(y){const S=v("toast"),a=i({response:"",temp:"",isLoading:!1}),s=i({name:"* 請選擇系統",APSYSNO:"*",ncik:"請選擇系統"}),r=i([{name:"* 請選擇系統",APSYSNO:"*",ncik:"請選擇系統"},{name:"TM 高階主管",APSYSNO:"TM",ncik:"高階主管"},{name:"AC 會計系統",APSYSNO:"AC",ncik:"會計系統"},{name:"CA 出納系統",APSYSNO:"CA",ncik:"出納系統"},{name:"TX 媒體申報",APSYSNO:"TX",ncik:"媒體申報"},{name:"PU 估驗系統",APSYSNO:"PU",ncik:"估驗系統"},{name:"ES 估算系統",APSYSNO:"ES",ncik:"估算系統"},{name:"PS 人事系統",APSYSNO:"PS",ncik:"人事系統"},{name:"MS 物料倉管",APSYSNO:"MS",ncik:"物料倉管"},{name:"PT 工程進度",APSYSNO:"PT",ncik:"工程進度"},{name:"PL 年度預算",APSYSNO:"PL",ncik:"年度預算"},{name:"DV 土地開發",APSYSNO:"DV",ncik:"土地開發"},{name:"WS 水電估算",APSYSNO:"WS",ncik:"水電估算"},{name:"ST 鋼筋撿料",APSYSNO:"ST",ncik:"鋼筋撿料"},{name:"SA 銷售系統",APSYSNO:"SA",ncik:"銷售系統"},{name:"EC 變更追加減",APSYSNO:"EC",ncik:"變更追加減"},{name:"QC 品質查核",APSYSNO:"QC",ncik:"品質查核"},{name:"PA 銷售前置",APSYSNO:"PA",ncik:"銷售前置"},{name:"ADMISYS 績效考核",APSYSNO:"ADMISYS",ncik:"績效考核"},{name:"MAINTSYS 客戶服務",APSYSNO:"MAINTSYS",ncik:"客戶服務"},{name:"HEALTSYS 健康管理",APSYSNO:"HEALTSYS",ncik:"健康管理"}]),c=async o=>{if(s.value.APSYSNO=="*"){S.add({severity:"error",summary:"系統別錯誤",detail:"請先選擇系統",life:1e4});return}a.value.isLoading=!0;let n=new FormData;n.append("file",o[0]);try{await p("/dll/"+s.value.APSYSNO).then(e=>{a.value.response=s.value.APSYSNO+` 系統關閉! 
移除了 `+e.data.count+` 個元件.
`,a.value.temp=e.data.msg+`
`,console.log("log:",e)}).catch(e=>{throw console.error("error:",e),e}),await A("put","/dll/",n).then(e=>{a.value.response+=o[0].name+` 上傳成功!
`,a.value.temp+=e.data.msg+`
`}).catch(e=>{throw console.error("error:",e),e}),await P("/dll/"+s.value.APSYSNO,{dllpath:o[0].name}).then(e=>{a.value.response+="AP "+e.data.path+" 成功安裝到 "+s.value.APSYSNO+`.
`,a.value.temp+=e.data.msg+`
`}).catch(e=>{throw console.error("error:",e),e}),a.value.response=a.value.response+`

`+a.value.temp,a.value.isLoading=!1,S.add({severity:"success",summary:"AP更新成功",detail:o[0].name+" 已上傳並安裝到 "+s.value.APSYSNO,life:15e3})}catch(e){a.value.response=e.response.data.msg,S.add({severity:"success",summary:o[0].name+"更新失敗",detail:e,life:15e3}),a.value.isLoading=!1}};return(o,n)=>(O(),f(k,null,[t(d,{text:"AP 更新"}),l("div",g,[l("div",L,[l("div",h,[n[2]||(n[2]=l("label",{class:"w:25% mr:1%",for:"selcode"},"1.選擇系統",-1)),t(m(N),{class:"",id:"selcode",modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=e=>s.value=e),options:r.value,optionLabel:"name",placeholder:"選擇系統",checkmark:"",filter:"",highlightOnSelect:!1},null,8,["modelValue","options"]),n[3]||(n[3]=l("label",{class:"flex mt:2%"},"2.載入AP程式(.DLL 並開始更新)",-1)),t(u,{class:"flex mt:10",isLoading:a.value.isLoading,allowedExtension:"dll",onHandleFileDrop:c},null,8,["isLoading"])]),l("div",w,[n[4]||(n[4]=l("label",{class:"flex mt:2%"},"3.執行結果",-1)),t(m(Y),{class:"mt:2%",modelValue:a.value.response,"onUpdate:modelValue":n[1]||(n[1]=e=>a.value.response=e),rows:"12",cols:"55",readonly:""},null,8,["modelValue"])])])])],64))}};export{U as default};
