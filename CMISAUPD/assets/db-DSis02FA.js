import{N as c}from"./index-B2HebM-Z.js";import{D as u,u as p}from"./service-Blihfj6M.js";import{f as N,a as P,e as O}from"./primevue-Cpy0qCi2.js";import{y as Y,r as t,b as f,c as v,u as o,d as l,L as i,s as k,F as T,z as E}from"./@vue-El9F00iI.js";import"./vue-router-DwT636uc.js";import"./@primeuix-DoH5r5kp.js";import"./@primevue-CPyEe4-z.js";/* empty css                   */import"./@master-24VFnj-k.js";import"./axios-upsvKRUO.js";const g={class:"mt:20 flex:row font:normal font:sans f:25"},D={class:"flex flex:row"},L={class:"flex:col w:50% mr:1%"},x={class:"flex:col w:50%"},H={__name:"db",setup(C){const r=Y("toast"),a=t({response:"",temp:"",isLoading:!1,isDragging:!1}),s=t({name:"* 請選擇系統",APSYSNO:"*",ncik:"請選擇系統"}),A=t([{name:"* 請選擇系統",APSYSNO:"*",ncik:"請選擇系統"},{name:"TM 高階主管",APSYSNO:"TM",ncik:"高階主管"},{name:"AC 會計系統",APSYSNO:"AC",ncik:"會計系統"},{name:"CA 出納系統",APSYSNO:"CA",ncik:"出納系統"},{name:"TX 媒體申報",APSYSNO:"TX",ncik:"媒體申報"},{name:"PU 估驗系統",APSYSNO:"PU",ncik:"估驗系統"},{name:"ES 估算系統",APSYSNO:"ES",ncik:"估算系統"},{name:"PS 人事系統",APSYSNO:"PS",ncik:"人事系統"},{name:"MS 物料倉管",APSYSNO:"MS",ncik:"物料倉管"},{name:"PT 工程進度",APSYSNO:"PT",ncik:"工程進度"},{name:"PL 年度預算",APSYSNO:"PL",ncik:"年度預算"},{name:"DV 土地開發",APSYSNO:"DV",ncik:"土地開發"},{name:"WS 水電估算",APSYSNO:"WS",ncik:"水電估算"},{name:"ST 鋼筋撿料",APSYSNO:"ST",ncik:"鋼筋撿料"},{name:"SA 銷售系統",APSYSNO:"SA",ncik:"銷售系統"},{name:"EC 變更追加減",APSYSNO:"EC",ncik:"變更追加減"},{name:"QC 品質查核",APSYSNO:"QC",ncik:"品質查核"},{name:"PA 銷售前置",APSYSNO:"PA",ncik:"銷售前置"},{name:"ADMISYS 績效考核",APSYSNO:"ADMISYS",ncik:"績效考核"},{name:"MAINTSYS 客戶服務",APSYSNO:"MAINTSYS",ncik:"客戶服務"},{name:"HEALTSYS 健康管理",APSYSNO:"HEALTSYS",ncik:"健康管理"}]),d=()=>{a.value.response=""},m=async S=>{if(s.value.APSYSNO=="*"){r.add({severity:"error",summary:"系統別錯誤",detail:"請先選擇系統",life:1e4});return}let e=new FormData;e.append("file",S[0]),a.value.isLoading=!0,await p("post","/sql/"+s.value.APSYSNO,e).then(n=>{a.value.response+=`USE[master]
`,a.value.response+="ALTER DATABASE ["+s.value.APSYSNO+`] SET SINGLE_USER WITH ROLLBACK IMMEDIATE
`,a.value.response+="RESTORE DATABASE ["+s.value.APSYSNO+"] FROM DISK = N'"+n.data.path+`' WITH FILE = 1, NOUNLOAD, REPLACE, STATS = 5
`,a.value.response+="ALTER DATABASE ["+s.value.APSYSNO+`] SET MULTI_USER
`,a.value.response+=`GO
`,console.log("log:",n),r.add({severity:"success",summary:"DB上傳成功",detail:S[0].name+" 123 "+s.value.APSYSNO,life:15e3})}).catch(n=>{a.value.response=n,console.error("error:",n)}),a.value.isLoading=!1};return(S,e)=>(f(),v(T,null,[o(c,{text:"DB 還原"}),l("div",g,[l("div",D,[l("div",L,[e[3]||(e[3]=l("label",{class:"w:25% mr:4",for:"selcode"},"1.選擇系統",-1)),o(i(N),{class:"",id:"selcode",modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=n=>s.value=n),options:A.value,optionLabel:"name",placeholder:"選擇系統",checkmark:"",highlightOnSelect:!1},null,8,["modelValue","options"]),e[4]||(e[4]=l("label",{class:"flex mt:15"},"2.載入DB檔案(.BAK 並開始上傳)",-1)),o(u,{allowedExtension:"bak",isLoading:a.value.isLoading,isDragging:a.value.isDragging,onHandleFileDrop:m,onHandleFileOpen:m},null,8,["isLoading","isDragging"]),o(i(P),{class:"ml:5",onClick:d},{default:k(()=>e[2]||(e[2]=[E("刪除紀錄")])),_:1})]),l("div",x,[e[5]||(e[5]=l("label",{class:"flex mt:15"},"3.T-SQL指令",-1)),o(i(O),{class:"mt:15",modelValue:a.value.response,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.response=n),rows:"15",cols:"70",readonly:""},null,8,["modelValue"])]),e[6]||(e[6]=l("br",null,null,-1))])])],64))}};export{H as default};
